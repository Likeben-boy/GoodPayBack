generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["relationJoins"]
}

datasource db {
  provider          = "mysql"
  url               = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Coupons {
  id            Int                 @id @default(autoincrement())
  couponName    String              @map("coupon_name") @db.VarChar(100)
  couponType    coupons_coupon_type @map("coupon_type")
  discountValue Decimal             @map("discount_value") @db.Decimal(10, 2)
  minAmount     Decimal?            @default(0.00) @map("min_amount") @db.Decimal(10, 2)
  maxDiscount   Decimal?            @map("max_discount") @db.Decimal(10, 2)
  totalCount    Int                 @default(0) @map("total_count")
  usedCount     Int                 @default(0) @map("used_count")
  validFrom     DateTime            @map("valid_from") @db.DateTime(0)
  validUntil    DateTime            @map("valid_until") @db.DateTime(0)
  status        coupons_status      @default(active)
  createdAt     DateTime            @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt     DateTime            @default(now()) @map("updated_at") @db.DateTime(0)
  deletedAt     DateTime?           @map("deleted_at") @db.DateTime(0)

  @@index([couponType], map: "idx_coupon_type")
  @@index([deletedAt], map: "idx_deleted_at")
  @@index([status], map: "idx_status")
  @@index([validFrom, validUntil], map: "idx_valid_period")
  @@map("coupons")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model DeliveryInfo {
  id               Int                           @id @default(autoincrement())
  orderId          Int                           @unique(map: "uk_order_id") @map("order_id")
  deliveryUserId   Int?                          @map("delivery_user_id")
  deliveryStatus   delivery_info_delivery_status @default(assigned) @map("delivery_status")
  assignedAt       DateTime?                     @map("assigned_at") @db.DateTime(0)
  pickedUpAt       DateTime?                     @map("picked_up_at") @db.DateTime(0)
  deliveredAt      DateTime?                     @map("delivered_at") @db.DateTime(0)
  deliveryDistance Decimal?                      @map("delivery_distance") @db.Decimal(8, 2)
  deliveryDuration Int?                          @map("delivery_duration")
  createdAt        DateTime                      @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt        DateTime                      @default(now()) @map("updated_at") @db.DateTime(0)

  @@index([deliveryStatus], map: "idx_delivery_status")
  @@index([deliveryUserId], map: "idx_delivery_user_id")
  @@map("delivery_info")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model DishCategories {
  id           Int      @id @default(autoincrement())
  restaurantId Int      @map("restaurant_id")
  name         String   @db.VarChar(50)
  sortOrder    Int      @default(0) @map("sort_order")
  status       Boolean  @default(true)
  createdAt    DateTime @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt    DateTime @default(now()) @map("updated_at") @db.DateTime(0)

  @@index([restaurantId], map: "idx_restaurant_id")
  @@index([sortOrder], map: "idx_sort_order")
  @@map("dish_categories")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Dishes {
  id           Int       @id @default(autoincrement())
  restaurantId Int       @map("restaurant_id")
  categoryId   Int       @map("category_id")
  name         String    @db.VarChar(100)
  description  String?   @db.Text
  price        Decimal   @default(0.00) @db.Decimal(8, 2)
  image        String?   @db.VarChar(255)
  status       Boolean   @default(true)
  salesCount   Int       @default(0) @map("sales_count")
  createdAt    DateTime  @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt    DateTime  @default(now()) @map("updated_at") @db.DateTime(0)
  deletedAt    DateTime? @map("deleted_at") @db.DateTime(0)

  @@index([categoryId], map: "idx_category_id")
  @@index([deletedAt], map: "idx_deleted_at")
  @@index([price], map: "idx_price")
  @@index([restaurantId], map: "idx_restaurant_id")
  @@index([salesCount], map: "idx_sales_count")
  @@index([status], map: "idx_status")
  @@map("dishes")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model OrderItems {
  id        Int      @id @default(autoincrement())
  orderId   Int      @map("order_id")
  dishId    Int      @map("dish_id")
  dishName  String   @map("dish_name") @db.VarChar(100)
  dishImage String?  @map("dish_image") @db.VarChar(255)
  dishPrice Decimal  @map("dish_price") @db.Decimal(8, 2)
  quantity  Int      @default(1)
  subtotal  Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now()) @map("created_at") @db.DateTime(0)
  orders    Orders   @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "order_items_orders_FK")

  @@index([dishId], map: "idx_dish_id")
  @@index([orderId], map: "idx_order_id")
  @@map("order_items")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model OrderReviews {
  id           Int                  @id @default(autoincrement())
  orderId      Int                  @unique(map: "uk_order_id") @map("order_id")
  userId       Int                  @map("user_id")
  restaurantId Int                  @map("restaurant_id")
  rating       Int                  @db.TinyInt
  content      String?              @db.Text
  images       Json?
  replyContent String?              @map("reply_content") @db.Text
  replyTime    DateTime?            @map("reply_time") @db.DateTime(0)
  status       order_reviews_status @default(published)
  createdAt    DateTime             @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt    DateTime             @default(now()) @map("updated_at") @db.DateTime(0)
  deletedAt    DateTime?            @map("deleted_at") @db.DateTime(0)
  orders       Orders               @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "order_reviews_orders_FK")

  @@index([deletedAt], map: "idx_deleted_at")
  @@index([rating], map: "idx_rating")
  @@index([restaurantId], map: "idx_restaurant_id")
  @@index([status], map: "idx_status")
  @@map("order_reviews")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model OrderStatusLogs {
  id           Int                              @id @default(autoincrement())
  orderId      Int                              @map("order_id")
  newStatus    order_status_logs_new_status     @map("new_status")
  operatorId   Int?                             @map("operator_id")
  operatorType order_status_logs_operator_type? @default(system) @map("operator_type")
  remark       String?                          @db.VarChar(255)
  createdAt    DateTime                         @default(now()) @map("created_at") @db.DateTime(0)
  orders       Orders                           @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "order_status_logs_orders_FK")

  @@index([createdAt], map: "idx_created_at")
  @@index([orderId], map: "idx_order_id")
  @@map("order_status_logs")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Orders {
  id                    Int                   @id @default(autoincrement())
  orderNumber           String                @unique(map: "order_number") @map("order_number") @db.VarChar(32)
  userId                Int                   @map("user_id")
  restaurantId          Int                   @map("restaurant_id")
  restaurantName       String               @db.VarChar(100) @map("restaurant_name")
  addressId             Int                   @map("address_id")
  contactName           String                @map("contact_name") @db.VarChar(50)
  contactPhone          String                @map("contact_phone") @db.VarChar(20)
  deliveryAddress       String                @map("delivery_address") @db.VarChar(255)
  orderStatus           orders_order_status   @default(created) @map("order_status")
  paymentStatus         orders_payment_status @default(pending) @map("payment_status")
  paymentMethod         orders_payment_method @map("payment_method")
  subtotal              Decimal               @default(0.00) @db.Decimal(10, 2)
  deliveryFee           Decimal               @default(0.00) @map("delivery_fee") @db.Decimal(10, 2)
  discountAmount        Decimal               @default(0.00) @map("discount_amount") @db.Decimal(10, 2)
  totalAmount           Decimal               @default(0.00) @map("total_amount") @db.Decimal(10, 2)
  couponId              Int?                  @map("coupon_id")
  orderNote             String?               @map("order_note") @db.Text
  deliveryTime          String?               @map("delivery_time") @db.VarChar(100)
  estimatedDeliveryTime DateTime?             @map("estimated_delivery_time") @db.DateTime(0)
  actualDeliveryTime    DateTime?             @map("actual_delivery_time") @db.DateTime(0)
  createdAt             DateTime              @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt             DateTime              @default(now()) @map("updated_at") @db.DateTime(0)
  paidAt                DateTime?             @map("paid_at") @db.DateTime(0)
  completedAt           DateTime?             @map("completed_at") @db.DateTime(0)
  cancelledAt           DateTime?             @map("cancelled_at") @db.DateTime(0)
  cancelReason          String?               @map("cancel_reason") @db.VarChar(255)
  orderItems            OrderItems[]
  orderReviews          OrderReviews?
  orderStatusLogs       OrderStatusLogs[]
  paymentRecords        PaymentRecords[]

  @@index([createdAt], map: "idx_created_at")
  @@index([orderNumber], map: "idx_order_number")
  @@index([orderStatus], map: "idx_order_status")
  @@index([paymentStatus], map: "idx_payment_status")
  @@index([restaurantId], map: "idx_restaurant_id")
  @@index([userId], map: "idx_user_id")
  @@map("orders")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model PaymentRecords {
  id            Int                            @id @default(autoincrement())
  orderId       Int                            @map("order_id")
  userId        Int                            @map("user_id")
  paymentMethod payment_records_payment_method @map("payment_method")
  paymentAmount Decimal                        @map("payment_amount") @db.Decimal(10, 2)
  transactionId String                         @map("transaction_id") @db.VarChar(100)
  paymentStatus payment_records_payment_status @default(pending) @map("payment_status")
  paymentTime   DateTime?                      @map("payment_time") @db.DateTime(0)
  failureReason String?                        @map("failure_reason") @db.VarChar(255)
  createdAt     DateTime                       @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt     DateTime                       @default(now()) @map("updated_at") @db.DateTime(0)
  orders        Orders                         @relation(fields: [orderId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "payment_records_orders_FK")

  @@index([orderId], map: "idx_order_id")
  @@index([paymentStatus], map: "idx_payment_status")
  @@index([transactionId], map: "idx_transaction_id")
  @@index([userId], map: "idx_user_id")
  @@map("payment_records")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model RefundRecords {
  id                  Int                            @id @default(autoincrement())
  orderId             Int                            @map("order_id")
  userId              Int                            @map("user_id")
  paymentRecordId     Int                            @map("payment_record_id")
  refundAmount        Decimal                        @map("refund_amount") @db.Decimal(10, 2)
  refundReason        String                         @map("refund_reason") @db.VarChar(255)
  refundType          refund_records_refund_type     @default(full) @map("refund_type")
  refundStatus        refund_records_refund_status   @default(pending) @map("refund_status")
  refundTransactionId String?                        @map("refund_transaction_id") @db.VarChar(100)
  processorId         Int?                           @map("processor_id")
  processorType       refund_records_processor_type? @default(system) @map("processor_type")
  processRemark       String?                        @map("process_remark") @db.VarChar(255)
  processedAt         DateTime?                      @map("processed_at") @db.DateTime(0)
  completedAt         DateTime?                      @map("completed_at") @db.DateTime(0)
  createdAt           DateTime                       @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt           DateTime                       @default(now()) @map("updated_at") @db.DateTime(0)

  @@index([createdAt], map: "idx_created_at")
  @@index([orderId], map: "idx_order_id")
  @@index([refundStatus], map: "idx_refund_status")
  @@index([userId], map: "idx_user_id")
  @@map("refund_records")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model RestaurantTagRelations {
  id            Int           @id @default(autoincrement())
  restaurantId  Int           @map("restaurant_id")
  tagId         Int           @map("tag_id")
  createdAt     DateTime      @default(now()) @map("created_at") @db.DateTime(0)
  createdBy     Int?          @map("created_by")
  restaurantTag RestaurantTag @relation(fields: [tagId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "restaurant_tag_relations_restaurant_tag_FK")
  restaurants   Restaurants   @relation(fields: [restaurantId], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "restaurant_tag_relations_restaurants_FK")

  @@unique([restaurantId, tagId], map: "uk_restaurant_tag")
  @@index([restaurantId], map: "idx_restaurant_id")
  @@index([tagId], map: "idx_tag_id")
  @@map("restaurant_tag_relations")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Restaurants {
  id                     Int                      @id @default(autoincrement())
  name                   String                   @db.VarChar(100)
  image                  String                   @db.VarChar(255)
  rating                 Decimal                  @default(0.0) @db.Decimal(2, 1)
  deliveryFee            Decimal                  @default(0.00) @map("delivery_fee") @db.Decimal(5, 2)
  deliveryTime           Int                      @default(0) @map("delivery_time")
  status                 Boolean                  @default(true)
  createdAt              DateTime                 @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt              DateTime                 @default(now()) @map("updated_at") @db.DateTime(0)
  deletedAt              DateTime?                @map("deleted_at") @db.DateTime(0)
  restaurantTagRelations RestaurantTagRelations[]

  @@index([deletedAt], map: "idx_deleted_at")
  @@index([rating], map: "idx_rating")
  @@index([status], map: "idx_status")
  @@map("restaurants")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model UserAddresses {
  id            Int       @id @default(autoincrement())
  userId        Int       @map("user_id")
  contactName   String    @map("contact_name") @db.VarChar(50)
  contactPhone  String    @map("contact_phone") @db.VarChar(20)
  province      String    @db.VarChar(50)
  city          String    @db.VarChar(50)
  district      String    @db.VarChar(50)
  detailAddress String    @map("detail_address") @db.VarChar(255)
  isDefault     Boolean   @default(false) @map("is_default")
  createdAt     DateTime  @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt     DateTime  @default(now()) @map("updated_at") @db.DateTime(0)
  deleteAt      DateTime? @map("delete_at") @db.DateTime(0)

  @@index([isDefault], map: "idx_is_default")
  @@index([userId], map: "idx_user_id")
  @@map("user_addresses")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model UserCoupons {
  id         Int                 @id @default(autoincrement())
  userId     Int                 @map("user_id")
  couponId   Int                 @map("coupon_id")
  orderId    Int?                @map("order_id")
  status     user_coupons_status @default(unused)
  receivedAt DateTime            @default(now()) @map("received_at") @db.DateTime(0)
  usedAt     DateTime?           @map("used_at") @db.DateTime(0)
  expiredAt  DateTime            @map("expired_at") @db.DateTime(0)

  @@unique([userId, couponId, receivedAt], map: "uk_user_coupon")
  @@index([couponId], map: "idx_coupon_id")
  @@index([expiredAt], map: "idx_expired_at")
  @@index([status], map: "idx_status")
  @@index([userId], map: "idx_user_id")
  @@map("user_coupons")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model Users {
  id        Int       @id @default(autoincrement())
  username  String    @db.VarChar(50)
  phone     String    @db.VarChar(20)
  password  String    @db.VarChar(255)
  avatar    String?   @db.VarChar(255)
  status    Boolean   @default(true)
  createdAt DateTime  @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt DateTime  @default(now()) @map("updated_at") @db.DateTime(0)
  deletedAt DateTime? @map("deleted_at") @db.DateTime(0)

  @@index([deletedAt], map: "idx_deleted_at")
  @@index([phone], map: "idx_phone")
  @@index([status], map: "idx_status")
  @@index([username], map: "idx_username")
  @@map("users")
}

/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
model RestaurantTag {
  id                     Int                      @id @default(autoincrement())
  tagName                String                   @unique(map: "tag_name") @map("tag_name") @db.VarChar(50)
  tagType                restaurant_tag_tag_type? @default(cuisine) @map("tag_type")
  color                  String?                  @default("#ff6b6b") @db.VarChar(7)
  icon                   String?                  @db.VarChar(100)
  sortOrder              Int                      @default(0) @map("sort_order")
  status                 Boolean                  @default(true)
  createdAt              DateTime                 @default(now()) @map("created_at") @db.DateTime(0)
  updatedAt              DateTime                 @default(now()) @map("updated_at") @db.DateTime(0)
  restaurantTagRelations RestaurantTagRelations[]

  @@index([sortOrder], map: "idx_sort_order")
  @@index([status], map: "idx_status")
  @@index([tagType], map: "idx_tag_type")
  @@map("restaurant_tag")
}

enum coupons_coupon_type {
  discount
  full_reduce
}

enum delivery_info_delivery_status {
  assigned
  picked_up
  delivering
  delivered
}

enum payment_records_payment_method {
  wechat
  alipay
  balance
  apple
}

enum user_coupons_status {
  unused
  used
  expired
}

enum order_status_logs_operator_type {
  user
  merchant
  delivery
  system
}

enum payment_records_payment_status {
  pending
  processing
  success
  failed
}

enum refund_records_refund_type {
  full
  partial
}

enum refund_records_refund_status {
  pending
  approved
  rejected
  completed
  failed
}

enum orders_order_status {
  created
  confirmed
  preparing
  delivering
  completed
  cancelled
}

enum order_reviews_status {
  published
  hidden
  deleted
}

enum orders_payment_status {
  pending
  processing
  success
  failed
  refunding
  refunded
}

enum coupons_status {
  active
  inactive
  expired
}

enum orders_payment_method {
  wechat
  alipay
  balance
  apple
}

enum refund_records_processor_type {
  user
  merchant
  system
}

enum restaurant_tag_tag_type {
  cuisine
  feature
  price_range
  service
}

enum order_status_logs_new_status {
  created
  confirmed
  preparing
  delivering
  completed
  cancelled
}
